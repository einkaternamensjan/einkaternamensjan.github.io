<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Footnote Preview</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { padding: 2rem; }
    article { max-width: 40rem; margin: 0 auto; }
  </style>
</head>
<body>
  <article id="sample-post">
    <h2>Sample Post</h2>
    <p>This is a sample sentence with a footnote reference <a href="#" class="footnote-ref" id="fnref-sample-post-1">[1]</a> to show the interactive tooltip.</p>

    <div class="footnotes">
      <h4>Footnotes</h4>
      <ol>
        <li id="fn-sample-post-1">This is the footnote content. <a href="#fnref-sample-post-1" class="footnote-backref">â†©</a></li>
      </ol>
    </div>
  </article>

  <script>
    // Minimal preview JS (reuses the template bubble code)
    var footnotesStore = { 'sample-post': [ { number: 1, text: 'This is the footnote content.' } ] };
    var _currentFootnoteBubble = null;

    function attachFootnoteHoverHandlers(article) {
      try {
        var refs = article.querySelectorAll('.footnote-ref');
        refs.forEach(function(ref) {
          ref.addEventListener('mouseenter', onFootnoteRefEnter);
          ref.addEventListener('mouseleave', onFootnoteRefLeave);
          ref.addEventListener('focus', onFootnoteRefEnter);
          ref.addEventListener('blur', onFootnoteRefLeave);
        });
      } catch (e) { console.error(e); }
    }

    function getFootnoteContent(postId, number) {
      var el = document.getElementById('fn-' + postId + '-' + number);
      if (el) return el.innerHTML;
      var arr = footnotesStore[postId] || [];
      var f = arr.find(function(x) { return x.number === number; });
      return f ? f.text : null;
    }

    function showFootnoteBubble(ref) {
      hideFootnoteBubble();
      if (!ref || !ref.id) return;
      var m = ref.id.match(/^fnref-(.+)-(\d+)$/);
      if (!m) return;
      var postId = m[1];
      var num = parseInt(m[2], 10);
      var content = getFootnoteContent(postId, num);
      if (!content) return;

      var bubble = document.createElement('div');
      bubble.className = 'footnote-bubble';
      bubble.innerHTML = content;
      document.body.appendChild(bubble);

      var rect = ref.getBoundingClientRect();
      bubble.style.position = 'absolute';
      bubble.style.zIndex = 2000;
      bubble.style.opacity = 0;
      bubble.style.transition = 'opacity 0.12s ease';

      requestAnimationFrame(function() {
        var left = rect.right + 8 + window.scrollX;
        var top = rect.top + window.scrollY;
        if (left + bubble.offsetWidth + 10 > window.innerWidth + window.scrollX) {
          left = rect.left - bubble.offsetWidth - 8 + window.scrollX;
        }
        if (top + bubble.offsetHeight > window.scrollY + window.innerHeight) {
          top = Math.max(window.scrollY + 8, window.scrollY + window.innerHeight - bubble.offsetHeight - 8);
        }
        bubble.style.left = left + 'px';
        bubble.style.top = top + 'px';
        bubble.style.opacity = 1;
      });

      _currentFootnoteBubble = bubble;
    }

    function hideFootnoteBubble() { if (_currentFootnoteBubble) { _currentFootnoteBubble.remove(); _currentFootnoteBubble = null; } }
    function onFootnoteRefEnter(e) { showFootnoteBubble(e.currentTarget); }
    function onFootnoteRefLeave() { hideFootnoteBubble(); }

    document.addEventListener('DOMContentLoaded', function() { attachFootnoteHoverHandlers(document.getElementById('sample-post')); });
  </script>
</body>
</html>
